# Install RAppArmor on OPENSUSE 12.1 / 12.2
# Tested on EC2 with public AMI: http://blog.susestudio.com/2012/10/public-opensuse-122-amazon-ec2-amis.html

#AppArmor is installed (RPM package "libapparmor") and enabled by default

#update the os
sudo zypper update

#some tools
sudo zypper install wget unzip make gcc

#install apparmor dependencies:
sudo zypper install libapparmor-devel apparmor-utils glibc-locale

#Add repostitory -- MAKE SURE TO REPLACE 12.2 WITH APPROPRIATE VERSION
sudo zypper addrepo -f http://download.opensuse.org/repositories/devel\:languages\:R\:patched/openSUSE_12.2 "R patched devel"

#install R patched (we need at least R 2.14)
sudo zypper install R-patched R-patched-devel

#download RAppArmor
wget https://github.com/jeroenooms/RAppArmor/zipball/master -O RAppArmor.zip --no-check-certificate
unzip RAppArmor.zip

#install rapparmor
sudo R CMD INSTALL jeroenooms-RAppArmor*

#install apparmor profiles
sudo zypper install apparmor-profiles apparmor-utils

#copy profiles (location depends on your architecture)
cd /usr/lib/R/library/RAppArmor/ || cd /usr/lib64/R/library/RAppArmor/
sudo cp -Rf profiles/suse/* /etc/apparmor.d/

#restart apparmor
rcapparmor restart
sudo aa-disable usr.bin.r